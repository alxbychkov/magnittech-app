import{_ as T,o as r,c as g,a as e,w as D,v as N,b as Q,p as H,d as M,r as h,e as q,f as W,n as w,g as b,B as L,L as X,h as $,i as I,t as O,u as _,M as y,j as A,k as J,l as C,F,E as Z,m as ee,q as te,s as se,x as ae,y as ne,z as le,A as oe,S as k,C as ie,D as ce,R as V,I as j}from"./index.ef84c6f1.js";const x=s=>(H("data-v-20eda08f"),s=s(),M(),s),de={class:"general"},ue={class:"input-item col-2"},re=x(()=>e("span",{class:"input-label"},"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u0437\u0430\u0434\u0430\u043D\u0438\u044F:",-1)),ve={class:"input-item"},_e=x(()=>e("span",{class:"input-label"},"\u0414\u0430\u0442\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0438\u044F:",-1)),me={class:"input-item col-3"},pe=x(()=>e("span",{class:"input-label"},"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435 \u0437\u0430\u0434\u0430\u043D\u0438\u044F:",-1)),fe=x(()=>e("div",{class:"line col-3"},null,-1)),he={class:"input-item"},ke=x(()=>e("span",{class:"input-label"},"\u0421\u0442\u0430\u0442\u0443\u0441 \u0437\u0430\u0434\u0430\u043D\u0438\u044F:",-1)),be=x(()=>e("option",{value:"\u0421\u043E\u0437\u0434\u0430\u043D"},"\u0421\u043E\u0437\u0434\u0430\u043D",-1)),ge=x(()=>e("option",{value:"\u041D\u0435 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0439"},"\u041D\u0435 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0439",-1)),ye=x(()=>e("option",{value:"\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D"},"\u041F\u0440\u043E\u0441\u0440\u043E\u0447\u0435\u043D",-1)),$e=x(()=>e("option",{value:"\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D"},"\u0417\u0430\u0432\u0435\u0440\u0448\u0435\u043D",-1)),xe=[be,ge,ye,$e],Ee={__name:"GeneralTab",props:{task:Object},setup(s){return(i,t)=>(r(),g("div",de,[e("div",ue,[re,D(e("input",{type:"text",class:"input input-name",placeholder:"\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435","onUpdate:modelValue":t[0]||(t[0]=a=>s.task.name=a)},null,512),[[N,s.task.name]])]),e("div",ve,[_e,D(e("input",{type:"date",class:"input input-date","onUpdate:modelValue":t[1]||(t[1]=a=>s.task.ends=a)},null,512),[[N,s.task.ends]])]),e("div",me,[pe,D(e("textarea",{class:"input",cols:"30",rows:"10",placeholder:"\u041E\u043F\u0438\u0441\u0430\u043D\u0438\u0435","onUpdate:modelValue":t[2]||(t[2]=a=>s.task.description=a)},null,512),[[N,s.task.description]])]),fe,e("div",he,[ke,D(e("select",{class:"input input-select","onUpdate:modelValue":t[3]||(t[3]=a=>s.task.status=a)},xe,512),[[Q,s.task.status]])])]))}},Ce=T(Ee,[["__scopeId","data-v-20eda08f"]]);const P=s=>(H("data-v-60732de6"),s=s(),M(),s),Se=P(()=>e("p",{class:"file-drop-title"},"\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0444\u0430\u0439\u043B",-1)),Oe=P(()=>e("p",{class:"file-drop-subtitle"}," \u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u043B\u0438 \u043F\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u043E\u0434\u0438\u043D \u0438\u043B\u0438 \u043D\u0435\u0441\u043A\u043E\u043B\u044C\u043A\u043E \u0444\u0430\u0439\u043B\u043E\u0432 ",-1)),we=[Se,Oe],Le={__name:"DropArea",emits:["onDropFiles"],setup(s,{emit:i}){const t=h(),a=h(!1),l=()=>{a.value=!0},c=()=>{a.value=!1},v=p=>{const f=p.dataTransfer.files;o(f)},n=p=>{p.preventDefault(),p.stopPropagation()},o=p=>{i("onDropFiles",p)};return q(()=>{t.value.addEventListener("dragenter",n,!1),t.value.addEventListener("dragleave",n,!1),t.value.addEventListener("dragover",n,!1),t.value.addEventListener("drop",n,!1),t.value.addEventListener("dragenter",l,!1),t.value.addEventListener("dragover",l,!1),t.value.addEventListener("dragleave",c,!1),t.value.addEventListener("drop",c,!1),t.value.addEventListener("drop",v,!1)}),W(()=>{t.value.removeEventListener("dragenter",n,!1),t.value.removeEventListener("dragleave",n,!1),t.value.removeEventListener("dragover",n,!1),t.value.removeEventListener("drop",n,!1),t.value.removeEventListener("dragenter",l,!1),t.value.removeEventListener("dragover",l,!1),t.value.removeEventListener("dragleave",c,!1),t.value.removeEventListener("drop",c,!1),t.value.removeEventListener("drop",v,!1)}),(p,f)=>(r(),g("div",{class:w(["file-drop",{highlight:a.value}]),ref_key:"dropArea",ref:t},we,2))}},Ie=T(Le,[["__scopeId","data-v-60732de6"]]);const B=s=>(H("data-v-fd5d2695"),s=s(),M(),s),Te={class:"documents"},De={class:"new-files"},He={class:"input-item"},Me=B(()=>e("input",{type:"text",class:"input input-file",placeholder:"\u0412\u044B\u0431\u0435\u0440\u0435\u0442\u0435 \u0444\u0430\u0439\u043B..."},null,-1)),Ne={key:0,class:"current-files"},Ae={key:1,class:"current-files"},Fe=B(()=>e("p",{class:"no-data"},"\u0424\u0430\u0439\u043B\u044B \u043A \u0437\u0430\u0434\u0430\u043D\u0438\u044E \u043E\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u044E\u0442 \u{1F644}",-1)),Ve=[Fe],Je=B(()=>e("br",null,null,-1)),Be={style:{color:"#106EDC"}},Re={__name:"FilesTab",props:{task:{type:Object,required:!0}},setup(s){const i=s,t=h(),a=h(!1),l=h([]),c=()=>{t.value.click()},v=f=>{let d;f instanceof Event?d=[...t.value.files]:d=[...f],d.forEach(u=>{const{lastModified:m,name:S}=u;i.task.files.push(JSON.stringify([m,S]))})},n=f=>{a.value=!0,l.value=[...f]},o=()=>{a.value=!1,l.value=[]},p=()=>{const d=i.task.files.map(u=>JSON.parse(u)).filter(u=>!l.value.includes(u[0]));i.task.files=d.map(u=>JSON.stringify(u)),a.value=!1,l.value=[]};return(f,d)=>(r(),g(F,null,[e("div",Te,[e("div",De,[b(Ie,{onOnDropFiles:v}),e("div",He,[e("input",{type:"file",class:"input-file-hidden",ref_key:"file",ref:t,onChange:v,multiple:""},null,544),Me,b(L,{caption:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C",class:"btn-blue",onClick:c})])]),s.task.files.length?(r(),g("div",Ne,[b(X,{head:["\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435"],items:s.task.files.map(u=>JSON.parse(u)),onOnDelete:n,actions:["delete"]},null,8,["items"])])):(r(),g("div",Ae,Ve))]),a.value?(r(),$(J,{key:0,title:_(y).delete.title,buttons:_(y).delete.buttons,onClose:o,onAgree:p},{default:I(()=>[e("p",null,O(_(y).delete.slot[0]),1),Je,e("p",null,[e("b",null,O(_(y).delete.slot[1]),1),A(),e("span",Be,O(l.value.length),1)])]),_:1},8,["title","buttons"])):C("",!0)],64))}},Ue=T(Re,[["__scopeId","data-v-fd5d2695"]]);const je={class:"comment-item"},qe={class:"comment-body"},Pe={class:"comment-bottom"},Ge={class:"comment-actions"},ze={class:"comment-date"},Ke={__name:"CommentItem",props:{comment:{type:Object,required:!0}},emits:["onEdit","onDelete"],setup(s,{emit:i}){const t=l=>{i("onEdit",l)},a=l=>{i("onDelete",l)};return(l,c)=>(r(),g("div",je,[e("div",qe,O(s.comment.body),1),e("div",Pe,[e("div",Ge,[e("button",{class:"btn-edit",onClick:c[0]||(c[0]=v=>t(s.comment))},[b(Z)]),e("button",{class:"btn-delete",onClick:c[1]||(c[1]=v=>a(s.comment))},[b(ee)])]),e("div",ze,O(s.comment.date),1)])]))}},Ye=T(Ke,[["__scopeId","data-v-417a657f"]]);const R=s=>(H("data-v-380f5d23"),s=s(),M(),s),Qe={class:"comments"},We={key:0,class:"comments-area"},Xe=R(()=>e("p",{class:"no-data"},"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0435\u0432 \u043A \u0437\u0430\u0434\u0430\u043D\u0438\u044E \u0435\u0449\u0435 \u043D\u0435\u0442 \u{1F615}",-1)),Ze=[Xe],et={key:1,class:"comments-area"},tt={class:"text-area"},st=R(()=>e("p",{class:"title"},"\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439 \u043A \u0437\u0430\u0434\u0430\u043D\u0438\u044E:",-1)),at=R(()=>e("br",null,null,-1)),nt={__name:"CommentsTab",props:{task:{type:Object,required:!0}},setup(s){const i=s,t=h(""),a=h(null),l=h("\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"),c=h(!1),v=()=>{const d={};if(a.value){const u=i.task.comments.indexOf(JSON.stringify(a.value)),m=i.task.comments.map(S=>JSON.parse(S));u&&m[u].body&&(m[u].body=t.value),i.task.comments=[...m.map(S=>JSON.stringify(S))],l.value="\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"}else{const u=new Date;d.id=u.getTime(),d.body=t.value,d.date=u.toLocaleString("ru-Ru"),i.task.comments.push(JSON.stringify(d))}t.value="",a.value=null},n=d=>{t.value=d.body,a.value=d,l.value="\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u043A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0439"},o=d=>{a.value=d,c.value=!0},p=()=>{c.value=!1,a.value=null},f=()=>{i.task.comments=[...i.task.comments.filter(d=>d!==JSON.stringify(a.value))],c.value=!1};return(d,u)=>(r(),g(F,null,[e("div",Qe,[s.task.comments.length?(r(),g("div",et,[(r(!0),g(F,null,te(s.task.comments.map(m=>JSON.parse(m)),m=>(r(),$(Ye,{comment:m,key:m.id,onOnEdit:n,onOnDelete:o},null,8,["comment"]))),128))])):(r(),g("div",We,Ze)),e("div",tt,[st,D(e("textarea",{class:"textarea",cols:"30",rows:"20","onUpdate:modelValue":u[0]||(u[0]=m=>t.value=m)},null,512),[[N,t.value]]),b(L,{caption:l.value,class:"btn-blue",onClick:v,disabled:!t.value},null,8,["caption","disabled"])])]),c.value?(r(),$(J,{key:0,title:_(y).delete.title,buttons:_(y).delete.buttons,onClose:p,onAgree:f},{default:I(()=>[e("p",null,O(_(y).delete.slot[0]),1),at]),_:1},8,["title","buttons"])):C("",!0)],64))}},lt=T(nt,[["__scopeId","data-v-380f5d23"]]);const ot=s=>(H("data-v-5dc38c71"),s=s(),M(),s),it={class:"tabs"},ct={class:"tabs-list"},dt={class:"navigation"},ut=ot(()=>e("div",{class:"separator"},null,-1)),rt={class:"tabs-body"},vt={__name:"TaskView",setup(s){const i=se(),t=ae(i,"tasks"),a=ne(),l=le(),c=h(!1),v=h(y.cancel),n=h({...j}),o=h(k[0]);oe(()=>{a.hash&&k.includes(a.hash.slice(1))&&(o.value=a.hash.slice(1))}),q(async()=>{t.value.length&&a.params.id&&(n.value=t.value.find(E=>E._id===a.params.id),n.value&&n.value.ends&&(n.value.ends=ie(n.value.ends)))}),ce(()=>{o.value!==a.hash.slice(1)&&(o.value=a.hash.slice(1))});const p=()=>{v.value={...y.save},c.value=!0},f=()=>{v.value={...y.cancel},c.value=!0},d=()=>{const E=k.indexOf(o.value)+1;l.push(`#${k[E]}`)},u=()=>{const E=k.indexOf(o.value)-1;l.push(`#${k[E]}`)},m=()=>{c.value=!1},S=async()=>{switch(v.value.type){case"save":if(a.params.id)await i.update(n.value);else{const{name:E,ends:U,status:G,description:z,files:K,comments:Y}={...n.value};n.value._id=await i.add({name:E,ends:U,status:G,description:z,files:K,comments:Y}),l.replace(`task/${n.value._id}#${o.value}`)}break;case"cancel":i.isLoaded=!1,i.get(),l.push("/"),n.value={...j};break}c.value=!1};return(E,U)=>(r(),g(F,null,[e("section",it,[e("ul",ct,[e("li",{class:w(["tab-item",{active:o.value==="general",visited:_(k).indexOf(o.value)>0}])},[b(_(V),{to:"#general",class:"tab-link"},{default:I(()=>[A("\u041E\u0441\u043D\u043E\u0432\u043D\u044B\u0435 \u043D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438")]),_:1})],2),e("li",{class:w(["tab-item",{active:o.value==="documents",visited:_(k).indexOf(o.value)>1}])},[b(_(V),{to:"#documents",class:w(["tab-link",{"no-event":!n.value.name}])},{default:I(()=>[A("\u0414\u043E\u043A\u0443\u043C\u0435\u043D\u0442\u044B")]),_:1},8,["class"])],2),e("li",{class:w(["tab-item",{active:o.value==="comments",visited:_(k).indexOf(o.value)>2}])},[b(_(V),{to:"#comments",class:w(["tab-link",{"no-event":!n.value.name}])},{default:I(()=>[A("\u041A\u043E\u043C\u043C\u0435\u043D\u0442\u0430\u0440\u0438\u0438")]),_:1},8,["class"])],2)])]),e("section",dt,[_(k).indexOf(o.value)>0?(r(),$(L,{key:0,caption:"\u041D\u0430\u0437\u0430\u0434",class:"btn-white prev",onClick:u})):C("",!0),_(k).indexOf(o.value)<2?(r(),$(L,{key:1,caption:"\u0414\u0430\u043B\u0435\u0435",class:"btn-white next",onClick:d,disabled:!n.value.name},null,8,["disabled"])):C("",!0),ut,b(L,{caption:"\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C",class:"btn-white save",onClick:p,disabled:!n.value.name},null,8,["disabled"]),b(L,{caption:"\u041E\u0442\u043C\u0435\u043D\u0430",class:"btn-white cancel",onClick:f})]),e("section",rt,[o.value==="general"?(r(),$(Ce,{key:0,task:n.value},null,8,["task"])):C("",!0),o.value==="documents"?(r(),$(Ue,{key:1,task:n.value},null,8,["task"])):C("",!0),o.value==="comments"?(r(),$(lt,{key:2,task:n.value},null,8,["task"])):C("",!0)]),c.value?(r(),$(J,{key:0,title:v.value.title,buttons:v.value.buttons,onClose:m,onAgree:S},{default:I(()=>[e("p",null,O(v.value.slot),1)]),_:1},8,["title","buttons"])):C("",!0)],64))}},mt=T(vt,[["__scopeId","data-v-5dc38c71"]]);export{mt as default};
